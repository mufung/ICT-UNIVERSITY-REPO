 <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Teacher Dashboard</title>
    <style>
        body { font-family: sans-serif; padding: 30px; background: #f0fdfa; }
        .box { max-width: 600px; margin: auto; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .upload-zone { border: 2px dashed #0d9488; padding: 25px; text-align: center; margin: 20px 0; background: #f8fafc; }
        button { background: #0d9488; color: white; border: none; padding: 12px; border-radius: 6px; cursor: pointer; width: 100%; }
        #status { margin-top: 15px; font-weight: bold; color: #15803d; }
    </style>
</head>
<body>
    <div class="box">
        <h1>Teacher Portal</h1>
        <div class="upload-zone">
            <input type="file" id="fileInput" accept=".txt">
            <p>Select <strong>teacher.txt</strong></p>
        </div>
        <button id="uploadBtn">Upload Batch Results</button>
        <div id="status"></div>
    </div>

    <script>
        // API Endpoint
        const API_URL = "https://7qpx0plfwg.execute-api.us-west-1.amazonaws.com/dev/submit-result";

        document.getElementById('uploadBtn').addEventListener('click', () => {
            const file = document.getElementById('fileInput').files[0];
            const status = document.getElementById('status');
            const token = localStorage.getItem('userToken');

            if (!file) return alert("No file selected.");
            if (!token) return window.location.href = "signin.html";

            const reader = new FileReader();
            reader.onload = async (e) => {
                const lines = e.target.result.split('\n').filter(l => l.trim() !== "");
                status.innerText = "Processing " + lines.length + " rows...";

                for (let line of lines) {
                    const parts = line.split(',');
                    const payload = { department: localStorage.getItem('userDept') || "Computer Science" };
                    parts.forEach(p => {
                        const [k, v] = p.split(':').map(s => s.trim());
                        payload[k] = (k === 'score') ? Number(v) : v;
                    });

                    try {
                        await fetch(API_URL, {
                            method: "POST",
                            headers: { 
                                "Content-Type": "application/json", 
                                "Authorization": token 
                            },
                            body: JSON.stringify(payload)
                        });
                    } catch (err) {
                        console.error("Upload error line:", line);
                    }
                }
                status.innerText = "âœ… All records submitted to Database.";
            };
            reader.readAsText(file);
        });
    </script>
</body>
</html>

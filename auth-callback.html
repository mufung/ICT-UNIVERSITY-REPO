 <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Authenticating...</title>
</head>
<body>

<script>
/*
 STEP 1: Get token from URL
 Cognito redirects like:
 auth-callback.html#id_token=XXXX&access_token=YYYY
*/

const hash = window.location.hash.substring(1);
const params = new URLSearchParams(hash);

const idToken = params.get("id_token");

if (!idToken) {
  alert("Authentication failed: No token received");
  window.location.href = "index.html";
}

/*
 STEP 2: Decode JWT (NO LIBRARY NEEDED)
*/
function parseJwt(token) {
  const base64Url = token.split('.')[1];
  const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
  return JSON.parse(atob(base64));
}

const decoded = parseJwt(idToken);

/*
 STEP 3: Read Cognito groups
*/
const groups = decoded["cognito:groups"] || [];

/*
 STEP 4: Redirect based on role
*/
if (groups.includes("Students")) {
  window.location.replace("student-dashboard.html");
}
else if (groups.includes("Teachers")) {
  window.location.replace("teacher-dashboard.html");
}
else {
  alert("User has no role assigned. Contact admin.");
  window.location.replace("index.html");
}
</script>

</body>
</html>
